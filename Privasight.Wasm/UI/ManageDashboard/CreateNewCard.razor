@using Privasight.Wasm.Services
@using Privasight.Wasm.UI.CardComponents.NumberCards.Base
@using Privasight.Model.Shared.Display
@using Privasight.Model.Shared.DataStructures.Dashboard

@inject DataService _dataService
@inject DialogService _dialogService
@inject NotificationService _notificationService

<RadzenSteps>
	<Steps>
		<RadzenStepsItem Text="Data Type">
			<h3>1. Select a data type</h3>
			<div class="d-flex justify-content-center">
				<RadzenListBox
					Data="_dataService.AvailableFileWrappers.Values.Select(t => t.Name)"
					@bind-Value="_fileWrapperTypeName"
					Class="w-75 h-75 d-flex text-center"/>
			</div>
			<p class="d-flex justify-content-center">Picked Type: @_fileWrapperTypeName</p>
		</RadzenStepsItem>
		<RadzenStepsItem Text="Card Type" Disabled="@string.IsNullOrWhiteSpace(_fileWrapperTypeName)">
			<div class="row">
				<div class="col-md-6">
					<NumberCard Title="Plain Number Card"/>
				</div>
				<div class="col-md-6">
					<NumberCard Title="Card With Line Chart" ShowLineChart="true"
					            Items="_templateItems"/>
				</div>
			</div>
			<div class="d-flex justify-content-around">
				<RadzenRadioButtonList @bind-Value="_cardStyle"
				                       TValue="CardTypes">
					<Items>
						<RadzenRadioButtonListItem Text="Plain Number Card" Value="CardTypes.PlainNumberCard"/>
						<RadzenRadioButtonListItem Text="With Line Chart" Value="CardTypes.WithLineChart"/>
					</Items>
				</RadzenRadioButtonList>
			</div>
		</RadzenStepsItem>
		<RadzenStepsItem Text="Detailed Dialog" Disabled="@string.IsNullOrWhiteSpace(_fileWrapperTypeName)">
			<RadzenRadioButtonList @bind-Value="_chosenDialog"
			                       TValue="DialogTypes">
				<Items>
					@* todo add demo display *@
					<RadzenRadioButtonListItem Text="No pop up dialog" Value="DialogTypes.Nothing"/>
					<RadzenRadioButtonListItem Text="@DialogTypes.DataList.ToString()" Value="DialogTypes.DataList"/>
					<RadzenRadioButtonListItem Text="@DialogTypes.DetailedTable.ToString()" Value="DialogTypes.DetailedTable"/>
				</Items>
			</RadzenRadioButtonList>
		</RadzenStepsItem>
	</Steps>
</RadzenSteps>
<div class="d-flex justify-content-center">
	<RadzenButton Class="mx-2" Text="Create Card" 
	              Disabled="@string.IsNullOrWhiteSpace(_fileWrapperTypeName)" 
	              ButtonStyle="ButtonStyle.Success"
	              Click="OnCreateButtonClick"/>
	<RadzenButton Class="mx-2" Text="Cancel" 
	              ButtonStyle="ButtonStyle.Danger"
	              Click="OnCancelButtonClick"/>
</div>

@code {
	private readonly IEnumerable<LineChartItem> _templateItems = new[]
	{
		new LineChartItem(0, DateTime.Parse("02/02/2022 00:00:00")),
		new LineChartItem(1, DateTime.Parse("03/02/2022 00:00:00")),
		new LineChartItem(2, DateTime.Parse("04/02/2022 00:00:00")),
		new LineChartItem(2, DateTime.Parse("05/02/2022 00:00:00"))
	};

	private string _fileWrapperTypeName = "";
	private CardTypes _cardStyle;
	private DialogTypes _chosenDialog;

	[Parameter, EditorRequired]
	public HashSet<CardSetting> CardSettings { get; set; } = null!;

	private void OnCreateButtonClick()
	{
		var newCardAdded = CardSettings.Add(new CardSetting(_fileWrapperTypeName, _chosenDialog, _cardStyle));
		var message = newCardAdded ? "Card added successfully." : "A card with the same setting already exists. No changes were done.";
		_notificationService.Notify(new NotificationMessage { Severity = NotificationSeverity.Success, Summary = message, Duration = 3000 });
		_dialogService.Close(true);
	}

	private void OnCancelButtonClick()
	{
		_dialogService.Close(false);
	}
}
